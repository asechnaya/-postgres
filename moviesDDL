-- Database: FILMS

-- DROP DATABASE "FILMS";

CREATE DATABASE "FILMS"
    WITH 
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'Russian_Russia.1251'
    LC_CTYPE = 'Russian_Russia.1251'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1;

-- #100DaysOfCode: DAY 5
-- CREATING TABLES

	
CREATE TABLE directors (

	id SERIAL PRIMARY KEY,
	name VARCHAR(30) UNIQUE NOT NULL,
	date_of_birth DATE NOT NULL,
	awards INT	
);

SELECT * FROM directors;

CREATE TABLE movies (
	
	id SERIAL PRIMARY KEY,
	name VARCHAR(40) UNIQUE NOT NULL,
	released_date DATE NOT NULL,
	director INT REFERENCES directors(id),
	lead_actor INT,
	rating INT CHECK(rating BETWEEN 1 AND 100)
);

SELECT * FROM movies;


-- Exercise 1: Data Definition Language

-- 1. Create a producers table, with id, name and date_of_birth columns. Make the id a primary key and the name unique. 
CREATE TABLE producers (

	id SERIAL PRIMARY KEY,
	name VARCHAR(30) UNIQUE,
	date_of_birth DATE
);

SELECT * FROM producers;

-- 2. Create a writers table with id, name and date_of_birth columns. Make the id a primary key and add any constraints that you like. 

CREATE TABLE writers (

	id SERIAL PRIMARY KEY,
	name VARCHAR(30) UNIQUE NOT NULL,
	date_of_birth DATE NOT NULL
);

SELECT * FROM writers;

-- #100DaysOfCode: DAY 6
-- HOW TO ADD AND REMOVE COLUMNS FROM A TABLE

ALTER TABLE directors 
ADD nationality VARCHAR(20); 

ALTER TABLE movies
ADD earning NUMERIC(6,2) NOT NULL;

ALTER TABLE movies
DROP rating;

SELECT * FROM movies;


-- MODIFYING COLUMNS (ADDING FOREIGN KEYS, CONSTRAINS, DATA TYPES)

CREATE TABLE actors (
	
	id SERIAL PRIMARY KEY,
	name VARCHAR(30) NOT NULL,
	gender CHAR(1) NOT NULL,
	date_of_birth DATE NOT NULL,
	nationality VARCHAR(20) NOT NULL
);


SELECT * FROM actors;
SELECT * FROM movies;

ALTER TABLE movies ADD FOREIGN KEY (lead_actor) REFERENCES actors(id);

ALTER TABLE actors ADD CONSTRAINT unique_name UNIQUE (name);
ALTER TABLE actors DROP CONSTRAINT unique_name;

ALTER TABLE actors ALTER COLUMN nationality SET NOT NULL;
ALTER TABLE actors ALTER COLUMN nationality DROP NOT NULL;

ALTER TABLE actors ALTER COLUMN name TYPE VARCHAR(40);

-- Exercise 2: Data definition Language 
--1. Add a producer_id column to the movies table. 

ALTER TABLE movies ADD COLUMN producer_id INT;

-- 2. Add a foreign key constraint to the producer_id column in the movies table that references the id column in the producers table. 

ALTER TABLE movies ADD FOREIGN KEY (producer_id) REFERENCES producers(id);

-- 3. Remove the writers table from the database.
DROP TABLE writers;
