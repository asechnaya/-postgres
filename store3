-- Database: store

-- DROP DATABASE store;

CREATE DATABASE store
    WITH 
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'Russian_Russia.1251'
    LC_CTYPE = 'Russian_Russia.1251'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1;
	
-- #100DaysOfCode: DAY 3
-- How to use the count function

SELECT COUNT(*) FROM employees;

SELECT * FROM products;

SELECT COUNT(*) FROM products
WHERE season = 'Summer';

SELECT COUNT(season) FROM products
WHERE season = 'Summer';

-- find out the number of orders in January.
SELECT COUNT(*) FROM orders
WHERE order_date BETWEEN '20170101' AND '20170131';

-- MIN AND MAX VALUES 
SELECT * FROM products;
SELECT MIN(wholesale_price) AS cheapest_product FROM products;
SELECT MAX(quantity) AS biggest_order FROM orders;

-- USING the SUM function

SELECT * FROM orders;
SELECT * FROM employees;

SELECT SUM(hours) FROM employees;

SELECT SUM(quantity) FROM orders
WHERE order_date BETWEEN '20170101' AND '20170131';

/* 
SELECT SUM(first_name) FROM employees;
Doesn't work because there are no arguments
*/

-- USING the AVERAGE function

SELECT AVG(pay) FROM employees;

SELECT AVG(price) FROM orders
WHERE quantity>1;

-- Grouping DATA by using GROUP BY

SELECT * FROM orders;

SELECT customer_id, SUM(price) FROM orders
GROUP BY customer_id;


SELECT * FROM orders WHERE customer_id = 3;

SELECT customer_id, product_id, SUM(price) FROM orders
GROUP BY customer_id, product_id
ORDER BY product_id;

SELECT c.first_name, c.last_name, p.name, SUM(o.price) FROM customers c
JOIN orders o ON c.id = o.customer_id
JOIN products p ON o.product_id = p.id
GROUP BY c.last_name, c.first_name, p.name
ORDER BY c.last_name;

-- Using the HAVING clause 

SELECT customer_id, SUM(price) FROM orders
GROUP BY customer_id
HAVING customer_id = 8;

SELECT c.first_name, c.last_name, p.name, SUM(o.price) FROM customers c
JOIN orders o ON c.id = o.customer_id
JOIN products p ON o.product_id = p.id
GROUP BY c.last_name, c.first_name, p.name
HAVING p.name LIKE '%Shirt%'
ORDER BY c.last_name;
